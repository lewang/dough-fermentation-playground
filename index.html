<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fermentation Parameter Predictor</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }
        
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        h1 {
            color: #4a5568;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.2em;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 30px;
            font-style: italic;
        }
        
        .input-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }
        
        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        
        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        input[type="number"]:disabled {
            background-color: #f7fafc;
            color: #a0aec0;
            cursor: not-allowed;
        }
        
        .predict-btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            margin-top: 20px;
        }
        
        .predict-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        .predict-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .result {
            margin-top: 30px;
            padding: 20px;
            background: #f0fff4;
            border: 2px solid #9ae6b4;
            border-radius: 8px;
            display: none;
        }
        
        .result.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .result h3 {
            color: #2d3748;
            margin-top: 0;
            font-size: 1.3em;
        }
        
        .result-value {
            font-size: 2em;
            font-weight: bold;
            color: #38a169;
            margin: 10px 0;
        }
        
        .equation {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            overflow-x: auto;
        }
        
        .equation h4 {
            margin: 0 0 10px 0;
            color: #4a5568;
        }
        
        .note {
            background: #fef5e7;
            border: 1px solid #f6e05e;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            font-size: 14px;
            color: #744210;
        }
        
        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 600px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }
        
        .input-hint {
            font-size: 12px;
            color: #718096;
            margin-top: 5px;
        }
        
        .error {
            background: #fed7d7;
            border: 2px solid #fc8181;
            color: #742a2a;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .error.show {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ§ª Fermentation Parameter Predictor</h1>
        <p class="subtitle">Enter any 2 parameters to predict the third using the Arrhenius kinetics model</p>
        
        <div class="grid">
            <div class="input-group">
                <label for="temperature">Temperature (Â°C)</label>
                <input type="number" id="temperature" step="0.1" min="1" max="50" placeholder="e.g., 15.0">
                <div class="input-hint">Range: 1-50Â°C</div>
            </div>
            
            <div class="input-group">
                <label for="yeast">Yeast Concentration (%)</label>
                <input type="number" id="yeast" step="0.001" min="0.001" max="1" placeholder="e.g., 0.1">
                <div class="input-hint">Range: 0.001-1.0%</div>
            </div>
        </div>
        
        <div class="input-group">
            <label for="time">Fermentation Time (hours)</label>
            <input type="number" id="time" step="0.1" min="0.1" max="500" placeholder="e.g., 50">
            <div class="input-hint">Range: 0.1-500 hours</div>
        </div>
        
        <button class="predict-btn" onclick="predict()">Predict Missing Parameter</button>
        
        <div class="result" id="result">
            <h3>Prediction Result</h3>
            <div id="resultContent"></div>
        </div>
        
        <div class="error" id="error">
            <strong>Error:</strong> <span id="errorMessage"></span>
        </div>
        
        <div class="equation">
            <h4>Arrhenius Kinetics Model:</h4>
            <div>Time = A Ã— exp(Ea/(RÃ—T<sub>kelvin</sub>)) Ã— (Yeast%)<sup>-n</sup></div>
            <div style="margin-top: 10px; font-size: 12px;">
                Where: A = 1.0Ã—10<sup>-9</sup>, Ea = 55,000 J/mol, R = 8.314 J/(molÂ·K), n = 0.5 (Optimized Parameters)
            </div>
        </div>
        
        <div class="note">
            <strong>Note:</strong> This model is based on fermentation data and provides approximate predictions. 
            Results are most accurate within the typical ranges shown above.
        </div>
    </div>

    <script>
        // Optimized Arrhenius model parameters
        const A = 1.00e-9;
        const Ea = 55000; // J/mol
        const R = 8.314;  // J/(molÂ·K)
        const n = 0.5;
        
        // Hardcoded CSV data for validation
        const yeastConcentrations = [0.004, 0.008, 0.013, 0.021, 0.032, 0.042, 0.053, 0.063, 0.074, 0.084, 0.126, 0.168, 0.210, 0.252, 0.294, 0.336, 0.420];
        const temperatures = [1.7, 2.2, 2.8, 3.3, 3.9, 4.4, 5.0, 5.6, 6.1, 6.7, 7.2, 7.8, 8.3, 8.9, 9.4, 10.0, 10.6, 11.1, 11.7, 12.2, 12.8, 13.3, 13.9, 14.4, 15.0, 15.6, 16.1, 16.7, 17.2, 17.8, 18.3, 18.9, 19.4, 20.0, 20.6, 21.1, 21.7, 22.2, 22.8, 23.3, 23.9, 24.4, 25.0, 25.6, 26.1, 26.7, 27.2, 27.8, 28.3, 28.9, 29.4, 30.0, 30.6, 31.1, 31.7, 32.2, 32.8, 33.3, 33.9, 34.4, 35.0];
        
        // Fermentation times data (null means no data available)
        const fermentationData = [
            [null,null,null,null,null,null,null,null,null,null,167,136,115,101,90,82,70], // 1.7Â°C
            [null,null,null,null,null,null,null,null,null,null,149,121,103,90,80,73,62], // 2.2Â°C
            [null,null,null,null,null,null,null,null,null,null,133,108,92,80,72,65,55], // 2.8Â°C
            [null,null,null,null,null,null,null,null,null,161,120,97,82,72,65,59,50], // 3.3Â°C
            [null,null,null,null,null,null,null,null,159,145,108,87,74,65,58,53,40], // 3.9Â°C
            [null,null,null,null,null,null,null,161,144,130,97,79,67,59,52,48,37], // 4.4Â°C
            [null,null,null,null,null,null,166,145,130,118,88,71,61,53,47,43,33], // 5.0Â°C
            [null,null,null,null,null,null,151,132,118,107,80,65,55,48,43,39,30], // 5.6Â°C
            [null,null,null,null,null,161,137,120,107,97,72,59,50,44,39,35,27], // 6.1Â°C
            [null,null,null,null,null,147,125,109,98,88,66,53,45,40,36,32,25], // 6.7Â°C
            [null,null,null,null,165,134,114,100,89,81,60,49,41,36,32,29,23], // 7.2Â°C
            [null,null,null,null,151,122,104,91,81,74,55,45,38,33,30,27,19], // 7.8Â°C
            [null,null,null,null,138,112,95,83,74,67,50,41,35,30,27,25,18], // 8.3Â°C
            [null,null,null,null,126,102,87,76,68,62,46,37,32,28,25,23,16], // 8.9Â°C
            [null,null,null,156,116,94,80,70,63,57,42,34,29,26,23,21,15], // 9.4Â°C
            [null,null,null,143,107,86,74,64,58,52,39,32,27,23,21,19,14], // 10.0Â°C
            [null,null,null,132,98,80,68,59,53,48,36,29,25,22,19,18,13], // 10.6Â°C
            [null,null,null,122,90,73,62,55,49,44,33,27,23,20,18,16,11], // 11.1Â°C
            [null,null,163,112,84,68,58,50,45,41,30,25,21,18,16,15,10], // 11.7Â°C
            [null,null,150,104,77,63,53,47,42,38,28,23,19,17,15,14,9], // 12.2Â°C
            [null,null,139,96,71,58,49,43,39,35,26,21,18,16,14,13,9], // 12.8Â°C
            [null,null,129,89,66,54,46,40,36,32,24,20,17,15,13,12,8], // 13.3Â°C
            [null,161,120,82,61,50,42,37,33,30,22,18,15,14,12,11,7], // 13.9Â°C
            [null,149,111,77,57,46,39,34,31,28,21,17,14,13,11,10,7], // 14.4Â°C
            [null,139,103,71,53,43,37,32,29,26,19,16,13,12,10,9,6], // 15.0Â°C
            [null,129,96,66,49,40,34,30,27,24,18,15,12,11,10,9,6], // 15.6Â°C
            [null,120,90,62,46,37,32,28,25,22,17,14,12,10,9,8,5], // 16.1Â°C
            [null,112,83,58,43,35,30,26,23,21,16,13,11,9,8,8,5], // 16.7Â°C
            [null,105,78,54,40,32,28,24,22,20,15,12,10,9,8,7,5], // 17.2Â°C
            [162,98,73,50,37,30,26,23,20,18,14,11,9,8,7,7,4], // 17.8Â°C
            [152,92,68,47,35,28,24,21,19,17,13,10,9,8,7,6,4], // 18.3Â°C
            [142,86,64,44,33,27,23,20,18,16,12,10,8,7,6,6,3], // 18.9Â°C
            [133,80,60,41,31,25,21,19,17,15,11,9,8,7,6,5,3], // 19.4Â°C
            [120,73,54,37,28,22,19,17,15,14,10,8,7,6,5,5,3], // 20.0Â°C
            [109,66,49,34,25,20,17,15,14,12,9,7,6,6,5,4,3], // 20.6Â°C
            [99,60,45,31,23,19,16,14,12,11,8,7,6,5,4,4,2], // 21.1Â°C
            [90,55,41,28,21,17,14,13,11,10,8,6,5,5,4,4,2], // 21.7Â°C
            [83,50,37,26,19,15,13,12,10,9,7,6,5,4,4,3,2], // 22.2Â°C
            [76,46,34,24,18,14,12,11,9,9,6,5,4,4,3,3,2], // 22.8Â°C
            [70,42,32,22,16,13,11,10,9,8,6,5,4,4,3,3,2], // 23.3Â°C
            [65,39,29,20,15,12,10,9,8,7,5,4,4,3,3,3,2], // 23.9Â°C
            [60,36,27,19,14,11,10,8,7,7,5,4,3,3,3,2,2], // 24.4Â°C
            [56,34,25,17,13,10,9,8,7,6,5,4,3,3,3,2,2], // 25.0Â°C
            [52,31,23,16,12,10,8,7,6,6,4,4,3,3,2,2,2], // 25.6Â°C
            [48,29,22,15,11,9,8,7,6,5,4,3,3,2,2,2,2], // 26.1Â°C
            [45,27,20,14,10,8,7,6,6,5,4,3,3,2,2,2,2], // 26.7Â°C
            [42,26,19,13,10,8,7,6,5,5,4,3,2,2,2,2,2], // 27.2Â°C
            [40,24,18,12,9,7,6,6,5,5,3,3,2,2,2,2,2], // 27.8Â°C
            [38,23,17,12,9,7,6,5,5,4,3,3,2,2,2,2,2], // 28.3Â°C
            [36,21,16,11,8,7,6,5,4,4,3,2,2,2,2,2,2], // 28.9Â°C
            [34,20,15,10,8,6,5,5,4,4,3,2,2,2,2,2,2], // 29.4Â°C
            [32,19,14,10,7,6,5,4,4,4,3,2,2,2,2,2,2], // 30.0Â°C
            [30,18,14,9,7,6,5,4,4,3,3,2,2,2,2,2,2], // 30.6Â°C
            [29,18,13,9,7,5,5,4,4,3,2,2,2,2,2,2,2], // 31.1Â°C
            [28,17,13,9,6,5,4,4,3,3,2,2,2,2,2,2,2], // 31.7Â°C
            [27,16,12,8,6,5,4,4,3,3,2,2,2,2,2,2,2], // 32.2Â°C
            [26,16,12,8,6,5,4,4,3,3,2,2,2,2,2,2,2], // 32.8Â°C
            [25,15,11,8,6,5,4,3,3,3,2,2,2,2,2,2,2], // 33.3Â°C
            [24,15,11,7,6,5,4,3,3,3,2,2,2,2,2,2,2], // 33.9Â°C
            [23,14,10,7,5,4,4,3,3,3,2,2,2,2,2,2,2], // 34.4Â°C
            [22,13,10,7,5,4,4,3,3,2,2,2,2,2,2,2,2]  // 35.0Â°C
        ];
        
        function findClosestDataPoint(temp, yeast, time) {
            let closestMatch = null;
            let minDistance = Infinity;
            
            // Search through all data points
            for (let tempIdx = 0; tempIdx < temperatures.length; tempIdx++) {
                for (let yeastIdx = 0; yeastIdx < yeastConcentrations.length; yeastIdx++) {
                    const dataTime = fermentationData[tempIdx][yeastIdx];
                    if (dataTime !== null) {
                        // Calculate distance based on which parameters we're comparing
                        let distance;
                        if (temp !== null && yeast !== null) {
                            // Looking for closest temp/yeast combination
                            distance = Math.abs(temperatures[tempIdx] - temp) + 
                                      Math.abs(yeastConcentrations[yeastIdx] - yeast) * 100; // Scale yeast difference
                        } else if (temp !== null && time !== null) {
                            // Looking for closest temp/time combination
                            distance = Math.abs(temperatures[tempIdx] - temp) + 
                                      Math.abs(dataTime - time) * 0.1; // Scale time difference
                        } else if (yeast !== null && time !== null) {
                            // Looking for closest yeast/time combination
                            distance = Math.abs(yeastConcentrations[yeastIdx] - yeast) * 100 + 
                                      Math.abs(dataTime - time) * 0.1;
                        }
                        
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestMatch = {
                                temperature: temperatures[tempIdx],
                                yeast: yeastConcentrations[yeastIdx],
                                time: dataTime,
                                distance: distance
                            };
                        }
                    }
                }
            }
            
            return closestMatch;
        }
        
        function getExactDataPoint(temp, yeast) {
            // Find exact or very close matches in the data
            const tempIdx = temperatures.findIndex(t => Math.abs(t - temp) < 0.1);
            const yeastIdx = yeastConcentrations.findIndex(y => Math.abs(y - yeast) < 0.001);
            
            if (tempIdx !== -1 && yeastIdx !== -1) {
                const time = fermentationData[tempIdx][yeastIdx];
                if (time !== null) {
                    return {
                        temperature: temperatures[tempIdx],
                        yeast: yeastConcentrations[yeastIdx],
                        time: time,
                        exact: true
                    };
                }
            }
            return null;
        }
        
        function clearResults() {
            document.getElementById('result').classList.remove('show');
            document.getElementById('error').classList.remove('show');
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.add('show');
            document.getElementById('result').classList.remove('show');
        }
        
        function showResult(content) {
            document.getElementById('resultContent').innerHTML = content;
            document.getElementById('result').classList.add('show');
            document.getElementById('error').classList.remove('show');
        }
        
        function predictTime(tempC, yeastPercent) {
            const tempK = tempC + 273.15;
            const time = A * Math.exp(Ea / (R * tempK)) * Math.pow(yeastPercent, -n);
            return time;
        }
        
        function predictTemperature(time, yeastPercent) {
            // Solve: time = A * exp(Ea/(R*T)) * yeast^(-n)
            // T = Ea / (R * ln(time / (A * yeast^(-n))))
            const innerTerm = time / (A * Math.pow(yeastPercent, -n));
            if (innerTerm <= 0) return null;
            
            const tempK = Ea / (R * Math.log(innerTerm));
            return tempK - 273.15;
        }
        
        function predictYeast(time, tempC) {
            // Solve: time = A * exp(Ea/(R*T)) * yeast^(-n)
            // yeast = (time / (A * exp(Ea/(R*T))))^(-1/n)
            const tempK = tempC + 273.15;
            const expTerm = A * Math.exp(Ea / (R * tempK));
            const yeastPercent = Math.pow(time / expTerm, -1/n);
            return yeastPercent;
        }
        
        function predict() {
            clearResults();
            
            const temp = parseFloat(document.getElementById('temperature').value) || null;
            const yeast = parseFloat(document.getElementById('yeast').value) || null;
            const time = parseFloat(document.getElementById('time').value) || null;
            
            // Count provided parameters
            const providedCount = [temp, yeast, time].filter(x => x !== null).length;
            
            if (providedCount !== 2) {
                showError('Please provide exactly 2 of the 3 parameters.');
                return;
            }
            
            let result = null;
            let resultHtml = '';
            
            try {
                let csvComparison = '';
                
                if (temp === null) {
                    // Predict temperature
                    result = predictTemperature(time, yeast);
                    if (result === null || isNaN(result) || result < -273.15 || result > 100) {
                        throw new Error('Cannot solve for temperature with these values');
                    }
                    
                    // Find closest CSV data point
                    const closest = findClosestDataPoint(null, yeast, time);
                    if (closest) {
                        csvComparison = `
                            <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <h4 style="margin: 0 0 10px 0; color: #1a365d;">ðŸ“Š Closest CSV Data Point:</h4>
                                <p><strong>Temperature:</strong> ${closest.temperature}Â°C (actual data)</p>
                                <p><strong>Yeast:</strong> ${closest.yeast}% | <strong>Time:</strong> ${closest.time} hours</p>
                                <p style="font-size: 12px; color: #4a5568;">This data point has yeast=${closest.yeast}% and time=${closest.time}h</p>
                            </div>
                        `;
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(1)}Â°C</div>
                        <p><strong>ðŸ”® Model Prediction:</strong> ${result.toFixed(1)}Â°C</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Fermentation Time: ${time} hours</li>
                            <li>Yeast Concentration: ${yeast}%</li>
                        </ul>
                        ${csvComparison}
                    `;
                } else if (yeast === null) {
                    // Predict yeast concentration
                    result = predictYeast(time, temp);
                    if (result === null || isNaN(result) || result <= 0 || result > 2) {
                        throw new Error('Cannot solve for yeast concentration with these values');
                    }
                    
                    // Find closest CSV data point
                    const closest = findClosestDataPoint(temp, null, time);
                    if (closest) {
                        csvComparison = `
                            <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                <h4 style="margin: 0 0 10px 0; color: #1a365d;">ðŸ“Š Closest CSV Data Point:</h4>
                                <p><strong>Yeast Concentration:</strong> ${closest.yeast}% (actual data)</p>
                                <p><strong>Temperature:</strong> ${closest.temperature}Â°C | <strong>Time:</strong> ${closest.time} hours</p>
                                <p style="font-size: 12px; color: #4a5568;">This data point has temp=${closest.temperature}Â°C and time=${closest.time}h</p>
                            </div>
                        `;
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(3)}%</div>
                        <p><strong>ðŸ”® Model Prediction:</strong> ${result.toFixed(3)}%</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Temperature: ${temp}Â°C</li>
                            <li>Fermentation Time: ${time} hours</li>
                        </ul>
                        ${csvComparison}
                    `;
                } else {
                    // Predict time
                    result = predictTime(temp, yeast);
                    if (result === null || isNaN(result) || result <= 0 || result > 1000) {
                        throw new Error('Cannot solve for fermentation time with these values');
                    }
                    
                    // Check for exact match first
                    const exactMatch = getExactDataPoint(temp, yeast);
                    if (exactMatch) {
                        csvComparison = `
                            <div style="background: #f0fff4; padding: 15px; border-radius: 8px; margin-top: 15px; border: 2px solid #68d391;">
                                <h4 style="margin: 0 0 10px 0; color: #1a365d;">ðŸŽ¯ Exact CSV Match Found!</h4>
                                <p><strong>Actual Time from CSV:</strong> ${exactMatch.time} hours</p>
                                <p><strong>Model Prediction:</strong> ${result.toFixed(1)} hours</p>
                                <p><strong>Difference:</strong> ${Math.abs(result - exactMatch.time).toFixed(1)} hours 
                                   (${((Math.abs(result - exactMatch.time) / exactMatch.time) * 100).toFixed(1)}% error)</p>
                            </div>
                        `;
                    } else {
                        // Find closest match
                        const closest = findClosestDataPoint(temp, yeast, null);
                        if (closest) {
                            csvComparison = `
                                <div style="background: #e6fffa; padding: 15px; border-radius: 8px; margin-top: 15px;">
                                    <h4 style="margin: 0 0 10px 0; color: #1a365d;">ðŸ“Š Closest CSV Data Point:</h4>
                                    <p><strong>Actual Time:</strong> ${closest.time} hours (from CSV)</p>
                                    <p><strong>Temperature:</strong> ${closest.temperature}Â°C | <strong>Yeast:</strong> ${closest.yeast}%</p>
                                    <p style="font-size: 12px; color: #4a5568;">This is the closest available data point in the CSV</p>
                                </div>
                            `;
                        }
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(1)} hours</div>
                        <p><strong>ðŸ”® Model Prediction:</strong> ${result.toFixed(1)} hours</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Temperature: ${temp}Â°C</li>
                            <li>Yeast Concentration: ${yeast}%</li>
                        </ul>
                        ${csvComparison}
                    `;
                }
                
                showResult(resultHtml);
                
            } catch (error) {
                showError(error.message || 'An error occurred during calculation. Please check your input values.');
            }
        }
        
        // Add event listeners for input validation
        document.getElementById('temperature').addEventListener('input', clearResults);
        document.getElementById('yeast').addEventListener('input', clearResults);
        document.getElementById('time').addEventListener('input', clearResults);
        
        // Allow Enter key to trigger prediction
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                predict();
            }
        });
    </script>
</body>
</html>