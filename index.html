<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dough Playground</title>
    
    <!-- Chota CSS Framework -->
    <link rel="stylesheet" href="https://unpkg.com/chota@latest">
    
    <style>
        :root {
            --bg-color: #667eea;
            --bg-secondary-color: #764ba2;
            --color-primary: #667eea;
            --color-lightGrey: #f7fafc;
            --color-grey: #e2e8f0;
            --color-darkGrey: #4a5568;
            --color-error: #f56565;
            --color-success: #48bb78;
            --grid-maxWidth: 1200px;
            
            /* Light mode colors */
            --surface-color: #ffffff;
            --surface-secondary: #f7fafc;
            --surface-tertiary: #e2e8f0;
            --text-primary: #2d3748;
            --text-secondary: #4a5568;
            --text-tertiary: #718096;
            --border-color: #e2e8f0;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --nav-bg: rgba(255, 255, 255, 0.95);
            --nav-shadow: rgba(0, 0, 0, 0.1);
        }
        
        @media (prefers-color-scheme: dark) {
            :root {
                --color-lightGrey: #2d3748;
                --color-grey: #4a5568;
                --color-darkGrey: #e2e8f0;
                --color-error: #fc8181;
                --color-success: #68d391;
                
                /* Dark mode colors */
                --surface-color: #1a202c;
                --surface-secondary: #2d3748;
                --surface-tertiary: #4a5568;
                --text-primary: #f7fafc;
                --text-secondary: #e2e8f0;
                --text-tertiary: #a0aec0;
                --border-color: #4a5568;
                --shadow-color: rgba(0, 0, 0, 0.3);
                --nav-bg: rgba(26, 32, 44, 0.95);
                --nav-shadow: rgba(0, 0, 0, 0.3);
            }
        }

        body {
            background: linear-gradient(135deg, var(--bg-color) 0%, var(--bg-secondary-color) 100%);
            min-height: 100vh;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Navigation Styles */
        .navbar {
            background: var(--nav-bg);
            backdrop-filter: blur(10px);
            box-shadow: 0 2px 20px var(--nav-shadow);
            position: sticky;
            top: 0;
            z-index: 1000;
            padding: 1rem 0;
        }

        .navbar .container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: var(--grid-maxWidth);
            margin: 0 auto;
            padding: 0 1rem;
        }

        .nav-brand {
            font-size: 1.5rem;
            font-weight: bold;
            color: var(--text-secondary);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-brand:hover {
            color: var(--color-primary);
        }

        /* Hamburger Menu */
        .nav-menu {
            display: flex;
            gap: 1rem;
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .nav-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }

        .nav-toggle:hover {
            color: var(--color-primary);
        }

        .nav-link {
            text-decoration: none;
            color: var(--text-secondary);
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--color-primary);
            color: white;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-toggle {
                display: block;
            }

            .nav-menu {
                position: fixed;
                left: -100%;
                top: 70px;
                flex-direction: column;
                background-color: var(--nav-bg);
                backdrop-filter: blur(10px);
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: 0 10px 27px var(--nav-shadow);
                padding: 2rem 0;
            }

            .nav-menu.active {
                left: 0;
            }

            .nav-link {
                display: block;
                margin: 0.5rem 0;
                font-size: 1.1rem;
            }
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
        }

        .content-container {
            background: var(--surface-color);
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px var(--shadow-color);
            margin: 0 auto;
            max-width: var(--grid-maxWidth);
            color: var(--text-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Custom Button Styles */
        .button.primary, .btn-custom {
            background: linear-gradient(135deg, var(--color-primary) 0%, var(--bg-secondary-color) 100%);
            border: none;
            color: white;
            font-weight: 600;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .button.primary:hover, .btn-custom:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        /* Result and Error Styles */
        .result-box {
            background: var(--surface-secondary);
            border: 2px solid var(--color-success);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
            color: var(--text-primary);
        }

        .result-box.show {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        .error-box {
            background: var(--surface-secondary);
            border: 2px solid var(--color-error);
            color: var(--color-error);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 2rem;
            display: none;
        }

        .error-box.show {
            display: block;
        }

        .result-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--color-success);
            margin: 1rem 0;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Model Testing Styles */
        .model-test { 
            margin: 1.5rem 0; 
            padding: 1.5rem; 
            border: 1px solid var(--border-color); 
            border-radius: 8px;
            background: var(--surface-secondary);
            color: var(--text-primary);
        }

        .model-test.good { 
            border-color: var(--color-success); 
            background: var(--surface-secondary);
        }

        .model-test.bad { 
            border-color: var(--color-error); 
            background: var(--surface-secondary);
        }

        .model-test.medium { 
            border-color: #ed8936; 
            background: var(--surface-secondary);
        }

        /* Advanced Models Styles */
        .model-result { 
            margin: 1rem 0; 
            padding: 1.5rem; 
            border: 1px solid var(--border-color); 
            border-radius: 8px; 
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
            background: var(--surface-secondary);
            color: var(--text-primary);
        }

        .model-result.excellent { 
            border-color: var(--color-success); 
        }

        .model-result.good { 
            border-color: var(--color-success); 
        }

        .model-result.fair { 
            border-color: #ed8936; 
        }

        .model-result.poor { 
            border-color: var(--color-error); 
        }

        .model-info { 
            flex: 1; 
            min-width: 300px;
        }

        .model-metrics { 
            text-align: right;
            font-weight: bold;
            min-width: 200px;
        }

        .winner {
            border: 3px solid var(--color-success);
            background: var(--surface-secondary);
            position: relative;
        }

        .winner::before {
            content: "üèÜ BEST MODEL";
            position: absolute;
            top: -10px;
            right: 10px;
            background: var(--color-success);
            color: white;
            padding: 0.3rem 0.8rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .equation-box {
            background: var(--surface-tertiary);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-family: 'Monaco', 'Consolas', monospace;
            font-size: 0.9rem;
            overflow-x: auto;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .parameters-box {
            background: var(--surface-tertiary);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 0.9rem;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .note-box {
            background: var(--surface-secondary);
            border: 1px solid var(--border-color);
            padding: 1rem;
            border-radius: 8px;
            margin-top: 1.5rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        /* Table Styles */
        table {
            margin: 1rem 0;
            background: var(--surface-color);
            color: var(--text-primary);
        }
        
        table th {
            background: var(--surface-secondary);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        table td {
            border-color: var(--border-color);
        }
        
        /* Form Styles */
        input[type="number"], textarea {
            background: var(--surface-color);
            color: var(--text-primary);
            border-color: var(--border-color);
        }
        
        input[type="number"]:focus {
            border-color: var(--color-primary);
        }
        
        label {
            color: var(--text-secondary);
        }
        
        .text-grey {
            color: var(--text-tertiary) !important;
        }
        
        small {
            color: var(--text-tertiary);
        }
        
        /* Chota Framework Dark Mode Overrides */
        @media (prefers-color-scheme: dark) {
            /* Override Chota's default styles for dark mode */
            .button, button {
                color: white;
            }
            
            .button.outline {
                color: var(--text-primary);
                border-color: var(--border-color);
            }
            
            .button.outline:hover {
                background: var(--color-primary);
                color: white;
            }
            
            h1, h2, h3, h4, h5, h6 {
                color: var(--text-primary);
            }
            
            p {
                color: var(--text-primary);
            }
            
            /* Dark mode text utilities */
            .text-center {
                color: var(--text-primary);
            }
        }

        /* Responsive adjustments */
        @media (max-width: 768px) {
            .content-container {
                margin: 1rem;
                padding: 1rem;
            }

            .model-result {
                flex-direction: column;
                text-align: center;
            }

            .model-metrics {
                text-align: center;
            }

            .result-value {
                font-size: 1.5rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="container">
            <a href="#" class="nav-brand">
                üçû‚ú® Dough Playground ‚ú®ü•ñ
            </a>
            <button class="nav-toggle" onclick="toggleMenu()">
                ‚ò∞
            </button>
            <ul class="nav-menu" id="navMenu">
                <li><a href="#" class="nav-link active" onclick="showTab('fermentation', this)">üß™ Fermentation Predictor</a></li>
                <li><a href="#" class="nav-link" onclick="showTab('optimization', this)">üìä Model Optimization</a></li>
                <li><a href="#" class="nav-link" onclick="showTab('advanced', this)">ü§ñ Advanced Models</a></li>
            </ul>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="main-content">
        <div class="container">
            <!-- Fermentation Predictor Tab -->
            <div id="fermentation" class="tab-content active">
                <div class="content-container">
                    <h1 class="text-center">üß™ Fermentation Parameter Predictor</h1>
                    <p class="text-center text-grey">Enter any 2 parameters to predict the third using the Arrhenius kinetics model</p>
                    
                    <div class="row">
                        <div class="col-6">
                            <label for="temperature">Temperature (¬∞C)</label>
                            <input type="number" id="temperature" step="0.1" min="1" max="50" placeholder="e.g., 15.0">
                            <small class="text-grey">Range: 1-50¬∞C</small>
                        </div>
                        
                        <div class="col-6">
                            <label for="yeast">Yeast Concentration (%)</label>
                            <input type="number" id="yeast" step="0.001" min="0.001" max="1" placeholder="e.g., 0.1">
                            <small class="text-grey">Range: 0.001-1.0%</small>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col">
                            <label for="time">Fermentation Time (hours)</label>
                            <input type="number" id="time" step="0.1" min="0.1" max="500" placeholder="e.g., 50">
                            <small class="text-grey">Range: 0.1-500 hours</small>
                        </div>
                    </div>
                    
                    <button class="button primary" onclick="predict()">Predict Missing Parameter</button>
                    
                    <div class="result-box" id="result">
                        <h3>Prediction Result</h3>
                        <div id="resultContent"></div>
                    </div>
                    
                    <div class="error-box" id="error">
                        <strong>Error:</strong> <span id="errorMessage"></span>
                    </div>
                    
                    <div class="equation-box">
                        <h4>Arrhenius Kinetics Model:</h4>
                        <div>Time = A √ó exp(Ea/(R√óT<sub>kelvin</sub>)) √ó (Yeast%)<sup>-n</sup></div>
                        <div style="margin-top: 10px; font-size: 0.8rem;">
                            Where: A = 1.0√ó10<sup>-9</sup>, Ea = 55,000 J/mol, R = 8.314 J/(mol¬∑K), n = 0.5 (Optimized Parameters)
                        </div>
                    </div>
                    
                    <div class="note-box">
                        <strong>Note:</strong> This model is based on fermentation data and provides approximate predictions. 
                        Results are most accurate within the typical ranges shown above.
                    </div>
                </div>
            </div>

            <!-- Model Optimization Tab -->
            <div id="optimization" class="tab-content">
                <div class="content-container">
                    <h1 class="text-center">üî¨ Fermentation Model Optimization</h1>
                    
                    <div class="model-test">
                        <h3>Current Model Performance</h3>
                        <p><strong>Arrhenius Model:</strong> Time = A √ó exp(Ea/(R√óT)) √ó (Yeast%)^(-n)</p>
                        <p>Current parameters: A = 2.5√ó10‚Åª‚Å∏, Ea = 45,000 J/mol, n = 0.6</p>
                        <div id="currentModelResults"></div>
                    </div>

                    <div class="row">
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="testCurrentModel()">Test Current Model</button>
                        </div>
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="optimizeModel()">Optimize Parameters</button>
                        </div>
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="testAlternativeModels()">Test Alternative Models</button>
                        </div>
                    </div>
                    
                    <div id="optimizationResults"></div>
                    
                    <div id="bestModel" class="model-test good" style="display: none;">
                        <h3>üèÜ Best Model Found</h3>
                        <div id="bestModelContent"></div>
                    </div>
                </div>
            </div>

            <!-- Advanced Models Tab -->
            <div id="advanced" class="tab-content">
                <div class="content-container">
                    <h1 class="text-center">üß¨ Advanced Fermentation Models</h1>
                    <p class="text-center text-grey">Testing various yeast growth and fermentation models against your CSV data</p>
                    
                    <div class="row">
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="testAllModels()">üß™ Test All Models</button>
                        </div>
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="findBestParameters()">üéØ Optimize Best Model</button>
                        </div>
                        <div class="col-4">
                            <button class="button outline btn-custom" onclick="showDetailedAnalysis()">üìä Detailed Analysis</button>
                        </div>
                    </div>
                    
                    <div id="advancedResults"></div>
                    <div id="detailedResults"></div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // Navigation functions
        function toggleMenu() {
            const navMenu = document.getElementById('navMenu');
            navMenu.classList.toggle('active');
        }

        function showTab(tabName, element) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            tabs.forEach(tab => tab.classList.remove('active'));
            
            // Remove active from all nav links
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabName).classList.add('active');
            
            // Activate nav link
            if (element) {
                element.classList.add('active');
            }
            
            // Close mobile menu
            document.getElementById('navMenu').classList.remove('active');
            
            // Initialize tab-specific functionality
            if (tabName === 'optimization') {
                setTimeout(() => testCurrentModel(), 100);
            } else if (tabName === 'advanced') {
                setTimeout(() => testAllModels(), 100);
            }
        }

        // Shared CSV data
        const yeastConcentrations = [0.004, 0.008, 0.013, 0.021, 0.032, 0.042, 0.053, 0.063, 0.074, 0.084, 0.126, 0.168, 0.210, 0.252, 0.294, 0.336, 0.420];
        const temperatures = [1.7, 2.2, 2.8, 3.3, 3.9, 4.4, 5.0, 5.6, 6.1, 6.7, 7.2, 7.8, 8.3, 8.9, 9.4, 10.0, 10.6, 11.1, 11.7, 12.2, 12.8, 13.3, 13.9, 14.4, 15.0, 15.6, 16.1, 16.7, 17.2, 17.8, 18.3, 18.9, 19.4, 20.0, 20.6, 21.1, 21.7, 22.2, 22.8, 23.3, 23.9, 24.4, 25.0, 25.6, 26.1, 26.7, 27.2, 27.8, 28.3, 28.9, 29.4, 30.0, 30.6, 31.1, 31.7, 32.2, 32.8, 33.3, 33.9, 34.4, 35.0];
        
        const fermentationData = [
            [null,null,null,null,null,null,null,null,null,null,167,136,115,101,90,82,70],
            [null,null,null,null,null,null,null,null,null,null,149,121,103,90,80,73,62],
            [null,null,null,null,null,null,null,null,null,null,133,108,92,80,72,65,55],
            [null,null,null,null,null,null,null,null,null,161,120,97,82,72,65,59,50],
            [null,null,null,null,null,null,null,null,159,145,108,87,74,65,58,53,40],
            [null,null,null,null,null,null,null,161,144,130,97,79,67,59,52,48,37],
            [null,null,null,null,null,null,166,145,130,118,88,71,61,53,47,43,33],
            [null,null,null,null,null,null,151,132,118,107,80,65,55,48,43,39,30],
            [null,null,null,null,null,161,137,120,107,97,72,59,50,44,39,35,27],
            [null,null,null,null,null,147,125,109,98,88,66,53,45,40,36,32,25],
            [null,null,null,null,165,134,114,100,89,81,60,49,41,36,32,29,23],
            [null,null,null,null,151,122,104,91,81,74,55,45,38,33,30,27,19],
            [null,null,null,null,138,112,95,83,74,67,50,41,35,30,27,25,18],
            [null,null,null,null,126,102,87,76,68,62,46,37,32,28,25,23,16],
            [null,null,null,156,116,94,80,70,63,57,42,34,29,26,23,21,15],
            [null,null,null,143,107,86,74,64,58,52,39,32,27,23,21,19,14],
            [null,null,null,132,98,80,68,59,53,48,36,29,25,22,19,18,13],
            [null,null,null,122,90,73,62,55,49,44,33,27,23,20,18,16,11],
            [null,null,163,112,84,68,58,50,45,41,30,25,21,18,16,15,10],
            [null,null,150,104,77,63,53,47,42,38,28,23,19,17,15,14,9],
            [null,null,139,96,71,58,49,43,39,35,26,21,18,16,14,13,9],
            [null,null,129,89,66,54,46,40,36,32,24,20,17,15,13,12,8],
            [null,161,120,82,61,50,42,37,33,30,22,18,15,14,12,11,7],
            [null,149,111,77,57,46,39,34,31,28,21,17,14,13,11,10,7],
            [null,139,103,71,53,43,37,32,29,26,19,16,13,12,10,9,6],
            [null,129,96,66,49,40,34,30,27,24,18,15,12,11,10,9,6],
            [null,120,90,62,46,37,32,28,25,22,17,14,12,10,9,8,5],
            [null,112,83,58,43,35,30,26,23,21,16,13,11,9,8,8,5],
            [null,105,78,54,40,32,28,24,22,20,15,12,10,9,8,7,5],
            [162,98,73,50,37,30,26,23,20,18,14,11,9,8,7,7,4],
            [152,92,68,47,35,28,24,21,19,17,13,10,9,8,7,6,4],
            [142,86,64,44,33,27,23,20,18,16,12,10,8,7,6,6,3],
            [133,80,60,41,31,25,21,19,17,15,11,9,8,7,6,5,3],
            [120,73,54,37,28,22,19,17,15,14,10,8,7,6,5,5,3],
            [109,66,49,34,25,20,17,15,14,12,9,7,6,6,5,4,3],
            [99,60,45,31,23,19,16,14,12,11,8,7,6,5,4,4,2],
            [90,55,41,28,21,17,14,13,11,10,8,6,5,5,4,4,2],
            [83,50,37,26,19,15,13,12,10,9,7,6,5,4,4,3,2],
            [76,46,34,24,18,14,12,11,9,9,6,5,4,4,3,3,2],
            [70,42,32,22,16,13,11,10,9,8,6,5,4,4,3,3,2],
            [65,39,29,20,15,12,10,9,8,7,5,4,4,3,3,3,2],
            [60,36,27,19,14,11,10,8,7,7,5,4,3,3,3,2,2],
            [56,34,25,17,13,10,9,8,7,6,5,4,3,3,3,2,2],
            [52,31,23,16,12,10,8,7,6,6,4,4,3,3,2,2,2],
            [48,29,22,15,11,9,8,7,6,5,4,3,3,2,2,2,2],
            [45,27,20,14,10,8,7,6,6,5,4,3,3,2,2,2,2],
            [42,26,19,13,10,8,7,6,5,5,4,3,2,2,2,2,2],
            [40,24,18,12,9,7,6,6,5,5,3,3,2,2,2,2,2],
            [38,23,17,12,9,7,6,5,5,4,3,3,2,2,2,2,2],
            [36,21,16,11,8,7,6,5,4,4,3,2,2,2,2,2,2],
            [34,20,15,10,8,6,5,5,4,4,3,2,2,2,2,2,2],
            [32,19,14,10,7,6,5,4,4,4,3,2,2,2,2,2,2],
            [30,18,14,9,7,6,5,4,4,3,3,2,2,2,2,2,2],
            [29,18,13,9,7,5,5,4,4,3,2,2,2,2,2,2,2],
            [28,17,13,9,6,5,4,4,3,3,2,2,2,2,2,2,2],
            [27,16,12,8,6,5,4,4,3,3,2,2,2,2,2,2,2],
            [26,16,12,8,6,5,4,4,3,3,2,2,2,2,2,2,2],
            [25,15,11,8,6,5,4,3,3,3,2,2,2,2,2,2,2],
            [24,15,11,7,6,5,4,3,3,3,2,2,2,2,2,2,2],
            [23,14,10,7,5,4,4,3,3,3,2,2,2,2,2,2,2],
            [22,13,10,7,5,4,4,3,3,2,2,2,2,2,2,2,2]
        ];

        // Shared utility functions
        function getValidDataPoints() {
            const dataPoints = [];
            for (let tempIdx = 0; tempIdx < temperatures.length; tempIdx++) {
                for (let yeastIdx = 0; yeastIdx < yeastConcentrations.length; yeastIdx++) {
                    const time = fermentationData[tempIdx][yeastIdx];
                    if (time !== null) {
                        dataPoints.push({
                            temp: temperatures[tempIdx],
                            yeast: yeastConcentrations[yeastIdx],
                            time: time
                        });
                    }
                }
            }
            return dataPoints;
        }

        // Fermentation Predictor Functions
        const A = 1.00e-9;
        const Ea = 55000;
        const R = 8.314;
        const n = 0.5;
        
        function findClosestDataPoint(temp, yeast, time) {
            let closestMatch = null;
            let minDistance = Infinity;
            
            for (let tempIdx = 0; tempIdx < temperatures.length; tempIdx++) {
                for (let yeastIdx = 0; yeastIdx < yeastConcentrations.length; yeastIdx++) {
                    const dataTime = fermentationData[tempIdx][yeastIdx];
                    if (dataTime !== null) {
                        let distance;
                        if (temp !== null && yeast !== null) {
                            distance = Math.abs(temperatures[tempIdx] - temp) + 
                                      Math.abs(yeastConcentrations[yeastIdx] - yeast) * 100;
                        } else if (temp !== null && time !== null) {
                            distance = Math.abs(temperatures[tempIdx] - temp) + 
                                      Math.abs(dataTime - time) * 0.1;
                        } else if (yeast !== null && time !== null) {
                            distance = Math.abs(yeastConcentrations[yeastIdx] - yeast) * 100 + 
                                      Math.abs(dataTime - time) * 0.1;
                        }
                        
                        if (distance < minDistance) {
                            minDistance = distance;
                            closestMatch = {
                                temperature: temperatures[tempIdx],
                                yeast: yeastConcentrations[yeastIdx],
                                time: dataTime,
                                distance: distance
                            };
                        }
                    }
                }
            }
            
            return closestMatch;
        }
        
        function getExactDataPoint(temp, yeast) {
            const tempIdx = temperatures.findIndex(t => Math.abs(t - temp) < 0.1);
            const yeastIdx = yeastConcentrations.findIndex(y => Math.abs(y - yeast) < 0.001);
            
            if (tempIdx !== -1 && yeastIdx !== -1) {
                const time = fermentationData[tempIdx][yeastIdx];
                if (time !== null) {
                    return {
                        temperature: temperatures[tempIdx],
                        yeast: yeastConcentrations[yeastIdx],
                        time: time,
                        exact: true
                    };
                }
            }
            return null;
        }
        
        function clearResults() {
            document.getElementById('result').classList.remove('show');
            document.getElementById('error').classList.remove('show');
        }
        
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('error').classList.add('show');
            document.getElementById('result').classList.remove('show');
        }
        
        function showResult(content) {
            document.getElementById('resultContent').innerHTML = content;
            document.getElementById('result').classList.add('show');
            document.getElementById('error').classList.remove('show');
        }
        
        function predictTime(tempC, yeastPercent) {
            const tempK = tempC + 273.15;
            const time = A * Math.exp(Ea / (R * tempK)) * Math.pow(yeastPercent, -n);
            return time;
        }
        
        function predictTemperature(time, yeastPercent) {
            const innerTerm = time / (A * Math.pow(yeastPercent, -n));
            if (innerTerm <= 0) return null;
            
            const tempK = Ea / (R * Math.log(innerTerm));
            return tempK - 273.15;
        }
        
        function predictYeast(time, tempC) {
            const tempK = tempC + 273.15;
            const expTerm = A * Math.exp(Ea / (R * tempK));
            const yeastPercent = Math.pow(time / expTerm, -1/n);
            return yeastPercent;
        }
        
        function predict() {
            clearResults();
            
            const temp = parseFloat(document.getElementById('temperature').value) || null;
            const yeast = parseFloat(document.getElementById('yeast').value) || null;
            const time = parseFloat(document.getElementById('time').value) || null;
            
            const providedCount = [temp, yeast, time].filter(x => x !== null).length;
            
            if (providedCount !== 2) {
                showError('Please provide exactly 2 of the 3 parameters.');
                return;
            }
            
            let result = null;
            let resultHtml = '';
            
            try {
                let csvComparison = '';
                
                if (temp === null) {
                    result = predictTemperature(time, yeast);
                    if (result === null || isNaN(result) || result < -273.15 || result > 100) {
                        throw new Error('Cannot solve for temperature with these values');
                    }
                    
                    const closest = findClosestDataPoint(null, yeast, time);
                    if (closest) {
                        csvComparison = `
                            <div class="equation-box" style="margin-top: 1rem;">
                                <h4>üìä Closest CSV Data Point:</h4>
                                <p><strong>Temperature:</strong> ${closest.temperature}¬∞C (actual data)</p>
                                <p><strong>Yeast:</strong> ${closest.yeast}% | <strong>Time:</strong> ${closest.time} hours</p>
                            </div>
                        `;
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(1)}¬∞C</div>
                        <p><strong>üîÆ Model Prediction:</strong> ${result.toFixed(1)}¬∞C</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Fermentation Time: ${time} hours</li>
                            <li>Yeast Concentration: ${yeast}%</li>
                        </ul>
                        ${csvComparison}
                    `;
                } else if (yeast === null) {
                    result = predictYeast(time, temp);
                    if (result === null || isNaN(result) || result <= 0 || result > 2) {
                        throw new Error('Cannot solve for yeast concentration with these values');
                    }
                    
                    const closest = findClosestDataPoint(temp, null, time);
                    if (closest) {
                        csvComparison = `
                            <div class="equation-box" style="margin-top: 1rem;">
                                <h4>üìä Closest CSV Data Point:</h4>
                                <p><strong>Yeast Concentration:</strong> ${closest.yeast}% (actual data)</p>
                                <p><strong>Temperature:</strong> ${closest.temperature}¬∞C | <strong>Time:</strong> ${closest.time} hours</p>
                            </div>
                        `;
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(3)}%</div>
                        <p><strong>üîÆ Model Prediction:</strong> ${result.toFixed(3)}%</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Temperature: ${temp}¬∞C</li>
                            <li>Fermentation Time: ${time} hours</li>
                        </ul>
                        ${csvComparison}
                    `;
                } else {
                    result = predictTime(temp, yeast);
                    if (result === null || isNaN(result) || result <= 0 || result > 1000) {
                        throw new Error('Cannot solve for fermentation time with these values');
                    }
                    
                    const exactMatch = getExactDataPoint(temp, yeast);
                    if (exactMatch) {
                        csvComparison = `
                            <div class="model-test good" style="margin-top: 1rem;">
                                <h4>üéØ Exact CSV Match Found!</h4>
                                <p><strong>Actual Time from CSV:</strong> ${exactMatch.time} hours</p>
                                <p><strong>Model Prediction:</strong> ${result.toFixed(1)} hours</p>
                                <p><strong>Difference:</strong> ${Math.abs(result - exactMatch.time).toFixed(1)} hours 
                                   (${((Math.abs(result - exactMatch.time) / exactMatch.time) * 100).toFixed(1)}% error)</p>
                            </div>
                        `;
                    } else {
                        const closest = findClosestDataPoint(temp, yeast, null);
                        if (closest) {
                            csvComparison = `
                                <div class="equation-box" style="margin-top: 1rem;">
                                    <h4>üìä Closest CSV Data Point:</h4>
                                    <p><strong>Actual Time:</strong> ${closest.time} hours (from CSV)</p>
                                    <p><strong>Temperature:</strong> ${closest.temperature}¬∞C | <strong>Yeast:</strong> ${closest.yeast}%</p>
                                </div>
                            `;
                        }
                    }
                    
                    resultHtml = `
                        <div class="result-value">${result.toFixed(1)} hours</div>
                        <p><strong>üîÆ Model Prediction:</strong> ${result.toFixed(1)} hours</p>
                        <p><strong>Input Values:</strong></p>
                        <ul>
                            <li>Temperature: ${temp}¬∞C</li>
                            <li>Yeast Concentration: ${yeast}%</li>
                        </ul>
                        ${csvComparison}
                    `;
                }
                
                showResult(resultHtml);
                
            } catch (error) {
                showError(error.message || 'An error occurred during calculation. Please check your input values.');
            }
        }

        // Model Optimization Functions
        function arrheniusModel(temp, yeast, A, Ea, n, R = 8.314) {
            const tempK = temp + 273.15;
            return A * Math.exp(Ea / (R * tempK)) * Math.pow(yeast, -n);
        }

        function powerLawModel(temp, yeast, a, b, c) {
            return a * Math.pow(temp, b) * Math.pow(yeast, c);
        }

        function exponentialModel(temp, yeast, a, b, c) {
            return a * Math.exp(b/temp) * Math.pow(yeast, c);
        }

        function calculatePerformance(dataPoints, modelFunc, params) {
            let totalError = 0;
            let totalSquaredError = 0;
            let totalAbsError = 0;
            let validPredictions = 0;
            const errors = [];

            for (const point of dataPoints) {
                try {
                    const predicted = modelFunc(point.temp, point.yeast, ...params);
                    if (isFinite(predicted) && predicted > 0) {
                        const error = predicted - point.time;
                        const absError = Math.abs(error);
                        const percentError = (absError / point.time) * 100;
                        
                        errors.push({
                            temp: point.temp,
                            yeast: point.yeast,
                            actual: point.time,
                            predicted: predicted,
                            error: error,
                            absError: absError,
                            percentError: percentError
                        });

                        totalError += error;
                        totalSquaredError += error * error;
                        totalAbsError += absError;
                        validPredictions++;
                    }
                } catch (e) {
                    // Skip invalid predictions
                }
            }

            if (validPredictions === 0) return null;

            const meanError = totalError / validPredictions;
            const rmse = Math.sqrt(totalSquaredError / validPredictions);
            const mae = totalAbsError / validPredictions;
            
            const meanActual = dataPoints.reduce((sum, p) => sum + p.time, 0) / dataPoints.length;
            let totalSumSquares = 0;
            for (const error of errors) {
                totalSumSquares += Math.pow(error.actual - meanActual, 2);
            }
            const rSquared = 1 - (totalSquaredError / totalSumSquares);

            return {
                meanError,
                rmse,
                mae,
                rSquared,
                validPredictions,
                errors: errors.sort((a, b) => b.percentError - a.percentError)
            };
        }

        function testCurrentModel() {
            const dataPoints = getValidDataPoints();
            const params = [2.5e-8, 45000, 0.6];
            const performance = calculatePerformance(dataPoints, arrheniusModel, params);
            
            let html = `
                <h4>Current Arrhenius Model Performance:</h4>
                <p><strong>Parameters:</strong> A = ${params[0]}, Ea = ${params[1]} J/mol, n = ${params[2]}</p>
                <p><strong>RMSE:</strong> ${performance.rmse.toFixed(2)} hours</p>
                <p><strong>MAE:</strong> ${performance.mae.toFixed(2)} hours</p>
                <p><strong>R¬≤:</strong> ${performance.rSquared.toFixed(4)}</p>
                <p><strong>Valid Predictions:</strong> ${performance.validPredictions}/${dataPoints.length}</p>
                
                <h5>Worst Predictions (highest % error):</h5>
                <table>
                    <thead>
                        <tr><th>Temp¬∞C</th><th>Yeast%</th><th>Actual</th><th>Predicted</th><th>Error</th><th>% Error</th></tr>
                    </thead>
                    <tbody>
            `;
            
            for (let i = 0; i < Math.min(10, performance.errors.length); i++) {
                const error = performance.errors[i];
                html += `<tr>
                    <td>${error.temp}</td>
                    <td>${error.yeast}</td>
                    <td>${error.actual}</td>
                    <td>${error.predicted.toFixed(1)}</td>
                    <td>${error.error.toFixed(1)}</td>
                    <td>${error.percentError.toFixed(1)}%</td>
                </tr>`;
            }
            html += '</tbody></table>';
            
            document.getElementById('currentModelResults').innerHTML = html;
        }

        function optimizeModel() {
            const dataPoints = getValidDataPoints();
            let bestParams = null;
            let bestScore = Infinity;
            let bestPerformance = null;

            document.getElementById('optimizationResults').innerHTML = '<p>üîÑ Optimizing parameters... This may take a moment.</p>';

            const AValues = [1e-9, 5e-9, 1e-8, 2.5e-8, 5e-8, 1e-7];
            const EaValues = [30000, 35000, 40000, 45000, 50000, 55000, 60000];
            const nValues = [0.3, 0.4, 0.5, 0.6, 0.7, 0.8, 0.9];

            setTimeout(() => {
                for (const A of AValues) {
                    for (const Ea of EaValues) {
                        for (const n of nValues) {
                            const params = [A, Ea, n];
                            const performance = calculatePerformance(dataPoints, arrheniusModel, params);
                            
                            if (performance && performance.rmse < bestScore) {
                                bestScore = performance.rmse;
                                bestParams = params;
                                bestPerformance = performance;
                            }
                        }
                    }
                }

                let html = `
                    <div class="model-test ${bestScore < 5 ? 'good' : bestScore < 15 ? 'medium' : 'bad'}">
                        <h3>üéØ Optimized Arrhenius Model</h3>
                        <p><strong>Best Parameters:</strong></p>
                        <ul>
                            <li>A = ${bestParams[0].toExponential(2)}</li>
                            <li>Ea = ${bestParams[1]} J/mol</li>
                            <li>n = ${bestParams[2]}</li>
                        </ul>
                        <p><strong>Performance:</strong></p>
                        <ul>
                            <li>RMSE: ${bestPerformance.rmse.toFixed(2)} hours</li>
                            <li>MAE: ${bestPerformance.mae.toFixed(2)} hours</li>
                            <li>R¬≤: ${bestPerformance.rSquared.toFixed(4)}</li>
                        </ul>
                        
                        <h4>JavaScript Code for Webapp:</h4>
                        <textarea readonly rows="3" style="width: 100%; font-family: monospace;">
const A = ${bestParams[0].toExponential(2)};
const Ea = ${bestParams[1]};
const n = ${bestParams[2]};
                        </textarea>
                    </div>
                `;

                document.getElementById('optimizationResults').innerHTML = html;
                
                document.getElementById('bestModel').style.display = 'block';
                document.getElementById('bestModelContent').innerHTML = `
                    <p><strong>Optimized Arrhenius Model:</strong></p>
                    <p>Time = ${bestParams[0].toExponential(2)} √ó exp(${bestParams[1]}/(8.314√ó(T+273.15))) √ó (Yeast%)<sup>-${bestParams[2]}</sup></p>
                    <p><strong>RMSE:</strong> ${bestPerformance.rmse.toFixed(2)} hours (vs ${calculatePerformance(dataPoints, arrheniusModel, [2.5e-8, 45000, 0.6]).rmse.toFixed(2)} hours for original)</p>
                `;
            }, 100);
        }

        function testAlternativeModels() {
            const dataPoints = getValidDataPoints();
            let html = '<h3>üß™ Alternative Model Comparison</h3>';

            const models = [
                {
                    name: 'Current Arrhenius',
                    func: arrheniusModel,
                    params: [2.5e-8, 45000, 0.6],
                    equation: 'Time = 2.5√ó10‚Åª‚Å∏ √ó exp(45000/(8.314√ó(T+273.15))) √ó (Yeast%)‚Åª‚Å∞¬∑‚Å∂'
                },
                {
                    name: 'Power Law',
                    func: powerLawModel,
                    params: [850, -1.8, -0.65],
                    equation: 'Time = 850 √ó T‚Åª¬π¬∑‚Å∏ √ó (Yeast%)‚Åª‚Å∞¬∑‚Å∂‚Åµ'
                },
                {
                    name: 'Simple Exponential',
                    func: exponentialModel,
                    params: [0.001, 1000, -0.5],
                    equation: 'Time = 0.001 √ó exp(1000/T) √ó (Yeast%)‚Åª‚Å∞¬∑‚Åµ'
                }
            ];

            for (const model of models) {
                const performance = calculatePerformance(dataPoints, model.func, model.params);
                if (performance) {
                    const className = performance.rmse < 5 ? 'good' : performance.rmse < 15 ? 'medium' : 'bad';
                    html += `
                        <div class="model-test ${className}">
                            <h4>${model.name}</h4>
                            <div class="equation-box">${model.equation}</div>
                            <p><strong>RMSE:</strong> ${performance.rmse.toFixed(2)} hours | 
                               <strong>R¬≤:</strong> ${performance.rSquared.toFixed(4)} | 
                               <strong>MAE:</strong> ${performance.mae.toFixed(2)} hours</p>
                        </div>
                    `;
                }
            }

            document.getElementById('optimizationResults').innerHTML = html;
        }

        // Advanced Models Functions
        const advancedModels = [
            {
                name: "Optimized Arrhenius",
                equation: "Time = A √ó exp(Ea/(R√ó(T+273.15))) √ó (Yeast%)^(-n)",
                func: function(temp, yeast, A, Ea, n) {
                    const tempK = temp + 273.15;
                    return A * Math.exp(Ea / (8.314 * tempK)) * Math.pow(yeast, -n);
                },
                defaultParams: [1e-9, 55000, 0.5],
                paramNames: ["A", "Ea (J/mol)", "n"]
            },
            {
                name: "Power Law",
                equation: "Time = a √ó T^b √ó (Yeast%)^c",
                func: function(temp, yeast, a, b, c) {
                    return a * Math.pow(temp, b) * Math.pow(yeast, c);
                },
                defaultParams: [850, -1.8, -0.65],
                paramNames: ["a", "b", "c"]
            },
            {
                name: "Logistic Model",
                equation: "Time = a / (1 + b √ó exp(-c √ó Yeast √ó Temperature))",
                func: function(temp, yeast, a, b, c) {
                    return a / (1 + b * Math.exp(-c * yeast * temp));
                },
                defaultParams: [200, 100, 0.1],
                paramNames: ["a", "b", "c"]
            },
            {
                name: "Modified Gompertz",
                equation: "Time = A √ó exp(-exp((Œº/A) √ó (Œª - T) + 1)) / Yeast^n",
                func: function(temp, yeast, A, mu, lambda, n) {
                    return (A * Math.exp(-Math.exp((mu/A) * (lambda - temp) + 1))) / Math.pow(yeast, n);
                },
                defaultParams: [100, 2, 20, 0.5],
                paramNames: ["A", "Œº", "Œª", "n"]
            },
            {
                name: "Exponential-Power",
                equation: "Time = a √ó exp(b/T) √ó (Yeast%)^c",
                func: function(temp, yeast, a, b, c) {
                    return a * Math.exp(b/temp) * Math.pow(yeast, c);
                },
                defaultParams: [0.001, 1000, -0.5],
                paramNames: ["a", "b", "c"]
            }
        ];

        function getPerformanceClass(rmse) {
            if (rmse < 3) return 'excellent';
            if (rmse < 7) return 'good'; 
            if (rmse < 15) return 'fair';
            return 'poor';
        }

        function generateJavaScriptCode(model) {
            const params = model.defaultParams;
            let constants = '';
            let functionBody = '';
            
            switch(model.name) {
                case "Optimized Arrhenius":
                    constants = `const A = ${params[0].toExponential(2)};
const Ea = ${params[1]};
const n = ${params[2]};`;
                    functionBody = `function predictTime(temp, yeast) {
    const tempK = temp + 273.15;
    return A * Math.exp(Ea / (8.314 * tempK)) * Math.pow(yeast, -n);
}`;
                    break;
                    
                case "Power Law":
                    constants = `const a = ${params[0]};
const b = ${params[1]};
const c = ${params[2]};`;
                    functionBody = `function predictTime(temp, yeast) {
    return a * Math.pow(temp, b) * Math.pow(yeast, c);
}`;
                    break;
                    
                default:
                    return `// Parameters: ${model.paramNames.map((name, i) => `${name}=${params[i]}`).join(', ')}`;
            }
            
            return `// Model: ${model.name}
${constants}

${functionBody}`;
        }

        function testAllModels() {
            const dataPoints = getValidDataPoints();
            let results = [];

            for (const model of advancedModels) {
                const performance = calculatePerformance(dataPoints, model.func, model.defaultParams);
                if (performance) {
                    results.push({
                        model: model,
                        performance: performance
                    });
                }
            }

            results.sort((a, b) => a.performance.rmse - b.performance.rmse);

            let html = '<h3>üèÜ Model Performance Ranking</h3>';
            
            results.forEach((result, index) => {
                const performanceClass = getPerformanceClass(result.performance.rmse);
                const isWinner = index === 0;
                
                html += `
                    <div class="model-result ${performanceClass} ${isWinner ? 'winner' : ''}">
                        <div class="model-info">
                            <h4>${result.model.name}</h4>
                            <div class="equation-box">${result.model.equation}</div>
                            <div class="parameters-box">
                                Parameters: ${result.model.paramNames.map((name, i) => 
                                    `${name}=${result.model.defaultParams[i]}`
                                ).join(', ')}
                            </div>
                        </div>
                        <div class="model-metrics">
                            <div>RMSE: ${result.performance.rmse.toFixed(2)}h</div>
                            <div>R¬≤: ${result.performance.rSquared.toFixed(4)}</div>
                            <div>MAE: ${result.performance.mae.toFixed(2)}h</div>
                            <div>Predictions: ${result.performance.validPredictions}/${dataPoints.length}</div>
                        </div>
                    </div>
                `;
            });

            const bestModel = results[0];
            html += `
                <div class="model-test good" style="margin-top: 2rem;">
                    <h3>üéØ Winner: ${bestModel.model.name}</h3>
                    <p><strong>Why it's better:</strong></p>
                    <ul>
                        <li>Lowest RMSE: ${bestModel.performance.rmse.toFixed(2)} hours</li>
                        <li>Highest R¬≤: ${bestModel.performance.rSquared.toFixed(4)} (closer to 1.0 is better)</li>
                        <li>Most accurate predictions across all temperature and yeast ranges</li>
                    </ul>
                    
                    <h4>Updated JavaScript for your webapp:</h4>
                    <textarea readonly rows="6" style="width: 100%; font-family: monospace; background: #f8f9fa;">
${generateJavaScriptCode(bestModel.model)}
                    </textarea>
                </div>
            `;

            document.getElementById('advancedResults').innerHTML = html;
        }

        function findBestParameters() {
            document.getElementById('advancedResults').innerHTML = '<p>üîÑ Optimizing best model parameters... This may take a while.</p>';
            
            setTimeout(() => {
                document.getElementById('advancedResults').innerHTML += '<p>‚úÖ Parameter optimization complete! (Feature under development)</p>';
            }, 2000);
        }

        function showDetailedAnalysis() {
            const testCases = [
                { temp: 27.2, yeast: 0.210, actualTime: 2, description: "Your problem case" },
                { temp: 15.0, yeast: 0.126, actualTime: 19, description: "Mid-range test" },
                { temp: 35.0, yeast: 0.420, actualTime: 2, description: "High temp/yeast" }
            ];

            let html = '<h3>üîç Detailed Analysis for Specific Cases</h3>';
            
            for (const testCase of testCases) {
                html += `<h4>${testCase.description} (${testCase.temp}¬∞C, ${testCase.yeast}%, actual: ${testCase.actualTime}h)</h4>`;
                html += '<table><thead><tr><th>Model</th><th>Predicted</th><th>Error</th><th>% Error</th></tr></thead><tbody>';
                
                for (const model of advancedModels) {
                    try {
                        const predicted = model.func(testCase.temp, testCase.yeast, ...model.defaultParams);
                        const error = Math.abs(predicted - testCase.actualTime);
                        const percentError = (error / testCase.actualTime) * 100;
                        
                        const rowClass = percentError < 10 ? 'style="background: #f0fff4;"' : 
                                        percentError < 30 ? 'style="background: #fffaf0;"' : 
                                        'style="background: #fed7d7;"';
                        
                        html += `<tr ${rowClass}>
                            <td>${model.name}</td>
                            <td>${predicted.toFixed(1)}h</td>
                            <td>${error.toFixed(1)}h</td>
                            <td>${percentError.toFixed(1)}%</td>
                        </tr>`;
                    } catch (e) {
                        html += `<tr><td>${model.name}</td><td colspan="3">Error</td></tr>`;
                    }
                }
                html += '</tbody></table>';
            }

            document.getElementById('detailedResults').innerHTML = html;
        }

        // Event listeners
        document.getElementById('temperature').addEventListener('input', clearResults);
        document.getElementById('yeast').addEventListener('input', clearResults);
        document.getElementById('time').addEventListener('input', clearResults);
        
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                predict();
            }
        });

        // Close mobile menu when clicking outside
        document.addEventListener('click', function(event) {
            const navMenu = document.getElementById('navMenu');
            const navToggle = document.querySelector('.nav-toggle');
            
            if (!navToggle.contains(event.target) && !navMenu.contains(event.target)) {
                navMenu.classList.remove('active');
            }
        });
    </script>
</body>
</html>